<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>

    <script src='js/lib/zig.js'></script>
	<script src='js/lib/three.js'></script>
    <script src="js/lib/hammer.js"></script>
    <script src="js/lib/hammer.fakemultitouch.js"></script>
    <script src="js/lib/hammer.showtouches.js"></script>

	<script src='js/THREE.mesh.prototype.js'></script>
	<script src='js/User.js'></script>
	<script src='js/HiddenObject.js'></script>
	<script src='js/ProximityAudio.js'></script>
    <script src='js/TouchArea.js'></script>
    <script src='js/Explanation.js'></script>

<script type="text/javascript">
var scene;
var audio;

var users   = new Array();
var objects = new Array();

var boundaries ;

function init() {
	// make sure you add <div id='radar'></div> to your html body
	initZig();
	initThree();

    Hammer.plugins.showTouches();
    Hammer.plugins.fakeMultitouch();

    touchArea = new TouchArea(document.getElementById('touch'));
    explanation = new Explanation(document.getElementById('explanation'));
	audio = new ProximityAudio();
	
	HiddenObject.generateObjects(
		['red'],//, 'green', 'blue'],
		{
			x: { min: -500,	max: 500  },
			y: { min: 0,	max: 700 },
			z: { min: 1200,	max: 1600 }
		},
		{
			w: 200, h: 200, d: 200
		}
	);
	//objects.push(new HiddenObject('red', {width: 300, height: 300, depth: 300 }, {x: -500, y: 500, z: 2100}));
	//objects.push(new HiddenObject('blue', {width: 300, height: 300, depth: 300 }, {x: 400, y: 500, z: 1400}));
	//objects.push(new HiddenObject('green', {width: 300, height: 300, depth: 300 }, {x: 1000, y: 100, z: 3000}));
}
function initZig() {
	zig.addListener({
		
		onuserfound: function(user) {
			users.push(new User(user));
		},
		
		onuserlost: function(user) {
            for(u in users){
            if(users[u].id==user.id)users[u].destruct();
            }
		}	
	});
}
function initThree() {
	
	// prepare
	scene = new THREE.Scene();
	var camera = new THREE.PerspectiveCamera( 75, (window.innerWidth/2) / window.innerHeight, 1, 100000 );
	var renderer = new THREE.WebGLRenderer();
	var light = new THREE.PointLight( 0xFFFFFF );
	
	// scene
	renderer.setSize( window.innerWidth/2, window.innerHeight );
	document.getElementById('three').appendChild( renderer.domElement );
	
	// camera
	camera.position.x = 0;
	camera.position.y = 0;
	camera.position.z = 0;
	camera.lookAt(new THREE.Vector3(0, 0, 4000));
	camera.rotation.z = 0 * Math.PI / 180;
	//camera.scale = new THREE.Vector3( 1, -1, 1 );
	//camera.translateX(-1000);
	
	// lights
	light.position.set( 10, 0, 10 );
	scene.add(light);
	
	// action!
	function render() {
		requestAnimationFrame(render);
		
		renderer.render(scene, camera);
	}
	render();	
}


document.addEventListener('DOMContentLoaded', init, false);

</script>
<style>
body {
	margin: 0;
	padding: 0;
}
#three,
#touch {
	display: block;
	float: left;
	width: 48%;
	height: 100%;

}

#touch {
    border: 1px solid grey;
}
#explanation{
    text-align:center;
    width:inherit;
    bottom: 20px;
    font-family:sans-serif;
    position: absolute;
    background:#fff79b;
}

.square {
	float: left;
	width: 100px;
	height: 100px;
	margin: 10px 5px;
    opacity: 0.4;
}

.newDiv {
    border: 5px solid yellow;
    border-radius: 20px;
}

#rect_green { background: green;}
#rect_blue { background: blue; }
#rect_red { background: red; }

.highlight{ background: yellow;}

audio {
	display: none;
}
canvas {
	-webkit-transform: scaleY(-1);
}
</style>
</head>
<body>
<audio id="audio_red" src="audio/red.wav" preload="auto"></audio>
<audio id="audio_green" src="audio/green.wav" preload="auto"></audio>
<audio id="audio_blue" src="audio/blue.wav" preload="auto"></audio>
<audio id="audio_ping" src="audio/ping.wav" preload="auto"></audio>
<audio id="soundYe" src="audio/horse.mp3" preload="auto"></audio>
<audio id="soundNo" src="audio/buzz.mp3" preload="auto"></audio>

<div id="three"></div>
<div id="touch">
    <div id="explanation">
    Pinch-zoom here to create new squares <br>
    Hold shift to emulate on desktop <br>
    Don't use touch emulation in Chrome
    </div>


</div>



</body>
</html>
